# Development Dockerfile for Ollama Flow
# Optimized for development with hot-reload and debugging

FROM python:3.11-slim-bullseye

# Set environment variables for development
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PYTHONPATH=/app \
    DEBUG_MODE=true

# Install development dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    gcc \
    g++ \
    curl \
    git \
    vim \
    htop \
    procps \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy requirements first for better Docker layer caching
COPY requirements.txt .

# Install Python dependencies with development tools
RUN pip install --no-cache-dir -r requirements.txt && \
    pip install --no-cache-dir debugpy ipdb pytest-xdist black flake8

# Create necessary directories
RUN mkdir -p /app/data /app/logs /app/tmp

# Expose ports for dashboard and debugging
EXPOSE 8080 5678

# Development command with debugger support
CMD ["python3", "-m", "debugpy", "--listen", "0.0.0.0:5678", "--wait-for-client", "enhanced_framework.py", "--docker-mode", "--debug"]